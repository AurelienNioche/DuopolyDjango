{% extends "dashboard/base.html" %}
{% load staticfiles %}

{% block page_content %}


<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">{{  title }}</h1>
    </div>
    <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                {{  subtitle }}
            </div>
            <br>
            <br>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-6 col-lg-offset-3" align="center">
{#                        <a class="btn btn-info"#}
{#                           href="{% static url_pickle %}" download><i class="fa fa-download"></i> Download pickle data</a>#}
{#                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/SQLite370.svg/2000px-SQLite370.svg.png"#}
{#                            style="width: 20%">#}
                        <a class="btn btn-success"
                           onclick="getDatabaseURL();" download><i class="fa fa-download"></i> SQLite data</a>
                        <br>
                        <br>
                        <br>
                        <div class="progress" style="display: none;" id="progressdiv" hidden>
                            <div id="progressbar" class="progress-bar progress-bar-striped active" role="progressbar"
                                 aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                            </div>
                        </div>
                        <a id="flush" class="btn btn-danger" onclick="flushDB();" hidden><i class="fa fa-remove"></i> Flush DB</a>
                        <img id="done" src="/static/admin/img/icon-yes.svg" style="width: 30px;" hidden>
                    </div>
                    <!-- /.col-lg-6 (nested) -->
                </div>
                <!-- /.row (nested) -->
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
    </div>
    <!-- /.col-lg-12 -->
</div>
</div>
<!-- /.row -->
    <script>

    function getDatabaseURL() {

        $("#progressdiv").show();
        $("#done").hide();

        $.ajax({
            method: "GET",
            url: "/data/?sqlite=true",
            success: function (data) {
                downloadDB(data["url"]);
                $("#progressdiv").hide();
                $("#done").show();
                $("#flush").show();
            }
        })
    }

    function flushDB () {

        $.ajax({
            method: "GET",
            url: "/data/?flush=true",
            success: function () {
                console.log("Flushed!")
            }
        })

    }

    function downloadDB(url) {
        var link = document.createElement("a");
        link.href = "/static/" + url;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    </script>

{% endblock page_content %}
